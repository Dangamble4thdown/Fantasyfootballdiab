
import React, { useState, useEffect } from 'react';
import { 
  Trophy, 
  Shield, 
  Users, 
  Calendar, 
  MessageSquare, 
  Search, 
  Bell, 
  TrendingUp, 
  TrendingDown, 
  UserPlus, 
  Settings, 
  Menu, 
  X, 
  ArrowRight, 
  Activity,
  Newspaper,
  PenTool,
  User,
  Eye
} from 'lucide-react';
import { initializeApp } from 'firebase/app';
import { 
  getAuth, 
  onAuthStateChanged, 
  signInAnonymously, 
  signInWithCustomToken 
} from 'firebase/auth';
import { 
  getFirestore, 
  collection, 
  addDoc, 
  onSnapshot, 
  query, 
  serverTimestamp 
} from 'firebase/firestore';

// --- FIREBASE CONFIGURATION ---
const firebaseConfig = JSON.parse(__firebase_config);
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

// --- MOCK DATA ---
const LEAGUE_NAME = "Windsor Dynasty League";
const CURRENT_WEEK = 12;

// Extracted Rosters from Images
const ROSTER_SCOTT = [
  { id: 's1', name: "J. Herbert", position: "QB", team: "LAC", score: 3.34, status: "active" },
  { id: 's2', name: "D. Henry", position: "RB", team: "BAL", score: 19.20, status: "active" },
  { id: 's3', name: "C. Rodriguez", position: "RB", team: "WAS", score: 9.00, status: "active" },
  { id: 's4', name: "P. Washington", position: "WR", team: "JAX", score: 3.00, status: "active" },
  { id: 's5', name: "R. Rice", position: "WR", team: "KC", score: 6.80, status: "active" },
  { id: 's6', name: "T. Kelce", position: "TE", team: "KC", score: 19.60, status: "active" },
  { id: 's7', name: "D. London", position: "FLEX", team: "ATL", score: 15.40, status: "active" },
  { id: 's8', name: "Q. Johnston", position: "FLEX", team: "LAC", score: 0.00, status: "active" }
];

const ROSTER_PETE = [
  { id: 'p1', name: "L. Jackson", position: "QB", team: "BAL", score: 4.72, status: "active" },
  { id: 'p2', name: "A. Jeanty", position: "RB", team: "LV", score: 6.40, status: "active" },
  { id: 'p3', name: "E. Demercado", position: "RB", team: "ARI", score: 3.00, status: "active" },
  { id: 'p4', name: "Z. Flowers", position: "WR", team: "BAL", score: 9.80, status: "active" },
  { id: 'p5', name: "A. Brown", position: "WR", team: "PHI", score: 8.40, status: "active" },
  { id: 'p6', name: "T. Johnson", position: "TE", team: "NYG", score: 5.10, status: "active" },
  { id: 'p7', name: "K. Hunt", position: "FLEX", team: "KC", score: 12.70, status: "active" },
  { id: 'p8', name: "J. Williams", position: "FLEX", team: "DET", score: 17.70, status: "active" }
];

const ROSTER_ALAN = [
  { id: 'a1', name: "J. Allen", position: "QB", team: "BUF", score: 42.68, status: "active" },
  { id: 'a2', name: "Q. Judkins", position: "RB", team: "CLE", score: 5.90, status: "active" },
  { id: 'a3', name: "R. White", position: "RB", team: "TB", score: 7.20, status: "active" },
  { id: 'a4', name: "J. Chase", position: "WR", team: "CIN", score: 4.50, status: "active" },
  { id: 'a5', name: "E. Egbuka", position: "WR", team: "TB", score: 6.50, status: "active" },
  { id: 'a6', name: "T. McBride", position: "TE", team: "ARI", score: 22.50, status: "active" },
  { id: 'a7', name: "S. Diggs", position: "FLEX", team: "NE", score: 15.00, status: "active" },
  { id: 'a8', name: "O. Gadsden", position: "FLEX", team: "LAC", score: 5.10, status: "active" }
];

const ROSTER_MATTHEW = [
  { id: 'm1', name: "M. Mariota", position: "QB", team: "WAS", score: 15.42, status: "active" },
  { id: 'm2', name: "T. Etienne", position: "RB", team: "JAX", score: 19.30, status: "active" },
  { id: 'm3', name: "S. Barkley", position: "RB", team: "PHI", score: 9.50, status: "active" },
  { id: 'm4', name: "K. Shakir", position: "WR", team: "BUF", score: 0.20, status: "active" },
  { id: 'm5', name: "D. Moore", position: "WR", team: "CHI", score: 2.60, status: "active" },
  { id: 'm6', name: "H. Henry", position: "TE", team: "NE", score: 6.50, status: "active" },
  { id: 'm7', name: "J. Williams", position: "FLEX", team: "DAL", score: 9.80, status: "active" },
  { id: 'm8', name: "K. Walker", position: "FLEX", team: "SEA", score: 18.60, status: "active" }
];

const MOCK_TEAMS = [
  { id: 1, name: "Que Rico!!", owner: "louisdiab", wins: 9, losses: 2, pts: 1028.66, rank: 1, avatar: "bg-indigo-500" },
  { id: 2, name: "Situ's Window Cleaners", owner: "PierreDiab", wins: 8, losses: 3, pts: 1229.30, rank: 2, avatar: "bg-orange-500" },
  { id: 3, name: "NorkCityBrawlers", owner: "Alan (almurrieta22)", wins: 8, losses: 3, pts: 1163.50, rank: 3, avatar: "bg-green-600", roster: ROSTER_ALAN },
  { id: 4, name: "Hurts So Good", owner: "AlexSeguin", wins: 7, losses: 4, pts: 1133.48, rank: 4, avatar: "bg-emerald-500" },
  { id: 5, name: "JustwinBaby!", owner: "paulholub", wins: 7, losses: 4, pts: 1117.72, rank: 5, avatar: "bg-green-400" },
  { id: 6, name: "The Charbonnet Sauvignons", owner: "NickSeguin", wins: 7, losses: 4, pts: 1065.88, rank: 6, avatar: "bg-red-400" },
  { id: 7, name: "Windsor Express", owner: "Grabka", wins: 6, losses: 5, pts: 1093.36, rank: 7, avatar: "bg-purple-500" },
  { id: 8, name: "Minimum Magnets", owner: "thesungawd", wins: 5, losses: 6, pts: 964.22, rank: 8, avatar: "bg-orange-400" },
  { id: 9, name: "#Tanking", owner: "Matthew (bdiab)", wins: 3, losses: 8, pts: 1103.04, rank: 9, avatar: "bg-blue-400", roster: ROSTER_MATTHEW },
  { id: 10, name: "Liam Mastronardi", owner: "LeeMastro", wins: 2, losses: 9, pts: 992.72, rank: 10, avatar: "bg-yellow-500" },
  { id: 11, name: "Injured Reserve", owner: "Scott (ScottyK37)", wins: 2, losses: 9, pts: 963.76, rank: 11, avatar: "bg-teal-400", roster: ROSTER_SCOTT },
  { id: 12, name: "MCDC", owner: "Pete (PeteDiab)", wins: 2, losses: 9, pts: 869.56, rank: 12, avatar: "bg-blue-800", roster: ROSTER_PETE },
];

// Alex's Roster (Hurts So Good)
const MY_ROSTER = [
  { id: 101, name: "J. Hurts", position: "QB", team: "PHI", proj: 21.69, score: 14.50, status: "active", opponent: "DET" },
  { id: 102, name: "K. Gainwell", position: "RB", team: "PHI", proj: 8.35, score: 26.00, status: "active", opponent: "PIT" },
  { id: 103, name: "B. Hall", position: "RB", team: "NYJ", proj: 12.10, score: 7.40, status: "active", opponent: "NE" },
  { id: 104, name: "C. Lamb", position: "WR", team: "DAL", proj: 17.04, score: 15.10, status: "active", opponent: "LV" },
  { id: 105, name: "T. Franklin", position: "WR", team: "DEN", proj: 8.04, score: 10.40, status: "active", opponent: "KC" },
  { id: 106, name: "Z. Ertz", position: "TE", team: "WAS", proj: 8.52, score: 6.20, status: "active", opponent: "MIA" },
  { id: 107, name: "J. Jeudy", position: "FLEX", team: "CLE", proj: 6.89, score: 3.60, status: "active", opponent: "BAL" },
  { id: 108, name: "M. Washington", position: "FLEX", team: "MIA", proj: 7.77, score: 5.70, status: "active", opponent: "WAS" },
  // Bench
  { id: 109, name: "J. McCarthy", position: "QB", team: "MIN", proj: 17.31, score: 6.00, status: "bench", opponent: "CHI" },
  { id: 110, name: "J. Taylor", position: "RB", team: "IND", proj: 0.00, score: 0.00, status: "bench", opponent: "BYE" },
  { id: 111, name: "E. Ayomanor", position: "WR", team: "TEN", proj: 6.76, score: 2.10, status: "bench", opponent: "HOU" },
  { id: 112, name: "K. Boutte", position: "WR", team: "NE", proj: 0.00, score: 0.00, status: "bench", opponent: "NYJ" },
  { id: 113, name: "J. Smith", position: "TE", team: "PIT", proj: 6.58, score: 0.00, status: "bench", opponent: "CIN" },
];

const WEEKLY_MATCHUPS = [
  { id: 1, team1: "Que Rico!!", score1: 98.14, team2: "Situ's Window Cleaners", score2: 91.52, status: "Final" },
  { id: 2, team1: "Liam Mastronardi", score1: 98.56, team2: "The Charbonnet Sauvignons", score2: 112.38, status: "Final" },
  { id: 3, team1: "Hurts So Good", score1: 88.90, team2: "Injured Reserve", score2: 76.34, status: "Final" },
  { id: 4, team1: "#Tanking", score1: 118.36, team2: "MCDC", score2: 67.82, status: "Final" },
  { id: 5, team1: "NorkCityBrawlers", score1: 109.38, team2: "Minimum Magnets", score2: 81.92, status: "Final" },
  { id: 6, team1: "JustwinBaby!", score1: 97.14, team2: "Windsor Express", score2: 84.44, status: "Final" },
];

const WAIVER_WIRE = [
  { id: 201, name: "P. Nacua", position: "WR", team: "LAR", proj: 14.5, pctOwned: 78, trend: "up" },
  { id: 202, name: "K. Williams", position: "RB", team: "LAR", proj: 15.2, pctOwned: 85, trend: "up" },
  { id: 203, name: "C. Stroud", position: "QB", team: "HOU", proj: 19.8, pctOwned: 65, trend: "up" },
  { id: 204, name: "J. Ford", position: "RB", team: "CLE", proj: 11.5, pctOwned: 45, trend: "flat" },
  { id: 205, name: "S. LaPorta", position: "TE", team: "DET", proj: 10.8, pctOwned: 60, trend: "up" },
];

const MESSAGES = [
  { id: 1, user: "louisdiab", text: "9-2 baby! Catch me if you can.", time: "10:42 AM", avatar: "bg-indigo-500" },
  { id: 2, user: "PierreDiab", text: "Window Cleaners coming for that #1 spot.", time: "10:45 AM", avatar: "bg-orange-500" },
  { id: 3, user: "AlexSeguin", text: "Kenny G with 26 points?! Saved my week.", time: "10:48 AM", avatar: "bg-emerald-500" },
];

const WEEK_11_RECAP_ARTICLE = {
  id: "week-11-recap",
  title: "Week 11 Recap: The Good, The Bad, & The Ugly",
  content: `Another week of Windsor Dynasty action is in the books, and boy was it spicy. Here's the rundown:

üî• THE GOOD: NorkCityBrawlers (Alan)
Josh Allen put the entire franchise on his back with 42.68 points! I don't know what kind of pre-game speech Alan gave, but it worked. The rest of the team basically tailgated while Allen destroyed the stat sheet. 109.38 total points with nearly half coming from one guy? That's efficiency.

‚ùÑÔ∏è THE BAD: Injured Reserve (Scott)
Scott, buddy. Justin Herbert with 3.34 points? I've seen kickers with flu games put up better numbers. Losing 76-88 to Alex is tough, but when your QB1 is getting outscored by your bench warmers, it's time to hit the panic button. "Injured Reserve" feels less like a team name and more like a lifestyle choice at this point.

ü§° THE UGLY: MCDC (Pete)
Pete... we need to talk. 67.82 points? Lamar Jackson with 4.72? Did Lamar decide to play left-handed? Did he leave at halftime? MCDC got absolutely dismantled by #Tanking (Matthew), who dropped 118.36. When you get blown out by 50 points by a team literally named "Tanking", you have to look in the mirror and ask yourself some hard questions.

üèÜ HONORABLE MENTION: #Tanking (Matthew)
Despite the name, Matthew isn't tanking very well. M. Mariota and K. Walker put on a clinic. Maybe change the name to #AccidentallyCompetent?`,
  tag: "Recap",
  author: "The Commish",
  timestamp: { seconds: Date.now() / 1000 }
};

// --- COMPONENTS ---

const StatCard = ({ title, value, trend, subtext, color }) => (
  <div className="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700">
    <div className="flex justify-between items-start">
      <div>
        <p className="text-sm text-slate-500 dark:text-slate-400 font-medium mb-1">{title}</p>
        <h3 className="text-2xl font-bold text-slate-900 dark:text-white">{value}</h3>
      </div>
      <div className={`p-2 rounded-lg ${color} bg-opacity-10`}>
        {trend === 'up' ? <TrendingUp size={20} className={color.replace('bg-', 'text-')} /> : 
         trend === 'down' ? <TrendingDown size={20} className={color.replace('bg-', 'text-')} /> :
         <Activity size={20} className={color.replace('bg-', 'text-')} />}
      </div>
    </div>
    {subtext && <p className="text-xs text-slate-400 mt-2">{subtext}</p>}
  </div>
);

const PlayerRow = ({ player, onAction, isRoster }) => {
  const isBench = player.status === 'bench';
  
  return (
    <div className={`flex items-center justify-between p-4 border-b border-slate-100 dark:border-slate-700 ${isBench ? 'bg-slate-50 dark:bg-slate-800/50' : 'bg-white dark:bg-slate-800'}`}>
      <div className="flex items-center space-x-4 flex-1">
        <div className={`w-8 h-8 flex items-center justify-center rounded-full font-bold text-xs 
          ${player.position === 'QB' ? 'bg-red-100 text-red-600' : 
            player.position === 'RB' ? 'bg-green-100 text-green-600' : 
            player.position === 'WR' ? 'bg-blue-100 text-blue-600' : 
            player.position.includes('TE') ? 'bg-orange-100 text-orange-600' : 'bg-gray-100 text-gray-600'}`}>
          {player.position.substring(0,2)}
        </div>
        <div>
          <p className="font-bold text-slate-800 dark:text-white">{player.name}</p>
          <p className="text-xs text-slate-500">{player.team} ‚Ä¢ {player.score ? `Score: ${player.score}` : `vs ${player.opponent}`}</p>
        </div>
      </div>
      
      <div className="flex items-center space-x-6 md:space-x-12">
        {player.score !== undefined && (
            <div className="text-center hidden md:block">
            <p className="text-xs text-slate-400">Points</p>
            <p className={`font-medium ${player.score > 15 ? 'text-emerald-600' : 'text-slate-700 dark:text-slate-300'}`}>{player.score}</p>
            </div>
        )}
        
        {isRoster && onAction && (
          <button 
            onClick={() => onAction(player.id)}
            className={`px-3 py-1 rounded-md text-xs font-medium transition-colors
              ${player.status === 'active' 
                ? 'bg-emerald-100 text-emerald-700 hover:bg-emerald-200' 
                : 'bg-amber-100 text-amber-700 hover:bg-amber-200'}`}
          >
            {player.status === 'active' ? 'STARTING' : 'BENCH'}
          </button>
        )}
        
        {!isRoster && !onAction && (
           <button className="p-2 rounded-full hover:bg-emerald-50 text-emerald-600">
             <UserPlus size={18} />
           </button>
        )}
      </div>
    </div>
  );
};

const NewsCard = ({ article }) => (
  <div className="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 mb-4 hover:shadow-md transition-shadow">
    <div className="flex justify-between items-start mb-2">
      <span className="px-2 py-1 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-300 text-xs rounded-md font-semibold uppercase tracking-wide">
        {article.tag || 'League News'}
      </span>
      <span className="text-xs text-slate-400">
        {article.timestamp?.seconds 
          ? new Date(article.timestamp.seconds * 1000).toLocaleDateString() 
          : 'Just now'}
      </span>
    </div>
    <h4 className="text-xl font-bold text-slate-900 dark:text-white mb-2">{article.title}</h4>
    <p className="text-slate-600 dark:text-slate-300 text-sm leading-relaxed whitespace-pre-wrap">{article.content}</p>
    <div className="mt-4 pt-4 border-t border-slate-100 dark:border-slate-700 flex items-center justify-between">
      <div className="flex items-center space-x-2">
        <div className="w-6 h-6 rounded-full bg-gradient-to-br from-indigo-400 to-purple-500 flex items-center justify-center text-white text-[10px] font-bold">
          {article.author ? article.author.substring(0,2).toUpperCase() : 'AN'}
        </div>
        <span className="text-xs font-medium text-slate-500 dark:text-slate-400">by {article.author || 'Anonymous'}</span>
      </div>
    </div>
  </div>
);

const MatchupRow = ({ matchup }) => (
  <div className="bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700 flex flex-col sm:flex-row items-center justify-between gap-4">
    <div className="flex-1 w-full flex justify-between items-center sm:justify-start sm:gap-4">
      <div className="text-right sm:text-left flex-1">
        <p className={`font-bold ${matchup.score1 > matchup.score2 ? 'text-emerald-600' : 'text-slate-700 dark:text-slate-300'}`}>{matchup.team1}</p>
        <p className="text-2xl font-bold">{matchup.score1}</p>
      </div>
    </div>
    
    <div className="px-4 py-1 bg-slate-100 dark:bg-slate-700 rounded-full text-xs font-bold text-slate-500">
      FINAL
    </div>

    <div className="flex-1 w-full flex justify-between items-center sm:justify-end sm:gap-4">
       <div className="text-left sm:text-right flex-1">
        <p className={`font-bold ${matchup.score2 > matchup.score1 ? 'text-emerald-600' : 'text-slate-700 dark:text-slate-300'}`}>{matchup.team2}</p>
        <p className="text-2xl font-bold">{matchup.score2}</p>
      </div>
    </div>
  </div>
);

export default function App() {
  const [activeTab, setActiveTab] = useState('dashboard');
  const [roster, setRoster] = useState(MY_ROSTER);
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
  
  // Auth & Newsletter State
  const [user, setUser] = useState(null);
  const [writerName, setWriterName] = useState('');
  const [isWriterModalOpen, setIsWriterModalOpen] = useState(false);
  const [articles, setArticles] = useState([WEEK_11_RECAP_ARTICLE]);
  const [isWriting, setIsWriting] = useState(false);
  const [newArticle, setNewArticle] = useState({ title: '', content: '', tag: 'News' });
  const [isPosting, setIsPosting] = useState(false);

  // Modal State for Viewing Teams
  const [selectedTeam, setSelectedTeam] = useState(null);

  // 1. Auth Setup
  useEffect(() => {
    const initAuth = async () => {
      if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
        await signInWithCustomToken(auth, __initial_auth_token);
      } else {
        await signInAnonymously(auth);
      }
    };
    initAuth();
    const unsubscribe = onAuthStateChanged(auth, (u) => {
      setUser(u);
      const savedName = localStorage.getItem('fantasy_writer_name');
      if (savedName) setWriterName(savedName);
    });
    return () => unsubscribe();
  }, []);

  // 2. Newsletter Data Fetching (Combines Local Mock + Firebase)
  useEffect(() => {
    if (!user) return;
    
    const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'newsletter'));
    const unsubscribe = onSnapshot(q, (snapshot) => {
      const fetched = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      fetched.sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));
      // Merge with the static week 11 recap
      setArticles([WEEK_11_RECAP_ARTICLE, ...fetched]);
    }, (error) => {
      console.error("Error fetching newsletter:", error);
    });

    return () => unsubscribe();
  }, [user]);

  const handleSetWriterName = (e) => {
    e.preventDefault();
    if (writerName.trim()) {
      localStorage.setItem('fantasy_writer_name', writerName);
      setIsWriterModalOpen(false);
    }
  };

  const handlePostArticle = async (e) => {
    e.preventDefault();
    if (!user || !writerName || !newArticle.title || !newArticle.content) return;

    setIsPosting(true);
    try {
      await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'newsletter'), {
        title: newArticle.title,
        content: newArticle.content,
        tag: newArticle.tag,
        author: writerName,
        authorId: user.uid,
        timestamp: serverTimestamp()
      });
      setNewArticle({ title: '', content: '', tag: 'News' });
      setIsWriting(false);
    } catch (error) {
      console.error("Error posting article:", error);
    } finally {
      setIsPosting(false);
    }
  };

  const togglePlayerStatus = (id) => {
    setRoster(current => current.map(p => {
      if (p.id === id) {
        return { ...p, status: p.status === 'active' ? 'bench' : 'active' };
      }
      return p;
    }));
  };

  const activePlayers = roster.filter(p => p.status === 'active');
  const benchPlayers = roster.filter(p => p.status === 'bench');

  const NavItem = ({ id, icon: Icon, label }) => (
    <button
      onClick={() => { setActiveTab(id); setIsMobileMenuOpen(false); }}
      className={`flex items-center space-x-3 w-full p-3 rounded-lg transition-all duration-200 ${
        activeTab === id 
          ? 'bg-indigo-600 text-white shadow-md shadow-indigo-200 dark:shadow-none' 
          : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800'
      }`}
    >
      <Icon size={20} />
      <span className="font-medium">{label}</span>
    </button>
  );

  return (
    <div className="min-h-screen bg-slate-50 dark:bg-slate-900 flex font-sans text-slate-900 dark:text-slate-100">
      
      {/* Sidebar */}
      <aside className="hidden lg:flex w-64 bg-white dark:bg-slate-950 border-r border-slate-200 dark:border-slate-800 flex-col fixed h-full z-10">
        <div className="p-6 border-b border-slate-100 dark:border-slate-800 flex items-center space-x-2">
          <div className="bg-indigo-600 p-2 rounded-lg">
            <Trophy className="text-white" size={24} />
          </div>
          <span className="text-lg font-bold text-slate-800 dark:text-white tracking-tight">DynastyHub</span>
        </div>
        
        <nav className="flex-1 p-4 space-y-1">
          <NavItem id="dashboard" icon={Shield} label="League Home" />
          <NavItem id="myteam" icon={Users} label="My Team" />
          <NavItem id="matchups" icon={Calendar} label="Matchups" />
          <NavItem id="players" icon={Search} label="Players" />
          <NavItem id="newsletter" icon={Newspaper} label="Newsletter" />
          <NavItem id="chat" icon={MessageSquare} label="Trash Talk" />
        </nav>

        <div className="p-4 border-t border-slate-100 dark:border-slate-800">
          <button className="flex items-center space-x-3 p-2 w-full hover:bg-slate-50 dark:hover:bg-slate-900 rounded-lg transition-colors">
            <div className="w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center text-white font-bold text-sm">
              AS
            </div>
            <div className="flex-1 text-left">
              <p className="text-sm font-medium text-slate-900 dark:text-white">AlexSeguin</p>
              <p className="text-xs text-emerald-600">Hurts So Good</p>
            </div>
            <Settings size={16} className="text-slate-400" />
          </button>
        </div>
      </aside>

      {/* Mobile Header */}
      <div className="lg:hidden fixed w-full bg-white dark:bg-slate-950 z-20 border-b border-slate-200 dark:border-slate-800 flex items-center justify-between p-4">
        <div className="flex items-center space-x-2">
          <Trophy className="text-indigo-600" size={24} />
          <span className="font-bold text-lg">DynastyHub</span>
        </div>
        <button onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}>
          {isMobileMenuOpen ? <X /> : <Menu />}
        </button>
      </div>

      {isMobileMenuOpen && (
        <div className="lg:hidden fixed inset-0 bg-white dark:bg-slate-950 z-10 pt-20 px-6">
          <nav className="space-y-2">
            <NavItem id="dashboard" icon={Shield} label="League Home" />
            <NavItem id="myteam" icon={Users} label="My Team" />
            <NavItem id="matchups" icon={Calendar} label="Matchups" />
            <NavItem id="players" icon={Search} label="Players" />
            <NavItem id="newsletter" icon={Newspaper} label="Newsletter" />
            <NavItem id="chat" icon={MessageSquare} label="Trash Talk" />
          </nav>
        </div>
      )}

      {/* Main Content */}
      <main className="flex-1 lg:ml-64 pt-20 lg:pt-0 min-h-screen">
        
        {/* Top Header */}
        <header className="hidden lg:flex items-center justify-between px-8 py-5 bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm sticky top-0 z-10 border-b border-slate-100 dark:border-slate-800">
          <div>
            <h2 className="text-2xl font-bold text-slate-900 dark:text-white">
              {activeTab === 'dashboard' ? LEAGUE_NAME : 
               activeTab === 'newsletter' ? 'League Insider' :
               activeTab === 'myteam' ? 'Hurts So Good' : 
               activeTab.charAt(0).toUpperCase() + activeTab.slice(1)}
            </h2>
            <p className="text-sm text-slate-500">Week {CURRENT_WEEK} ‚Ä¢ Season 2024</p>
          </div>
          <div className="flex items-center space-x-4">
             {writerName ? (
               <div className="px-3 py-1 bg-indigo-50 text-indigo-700 rounded-full text-xs font-semibold border border-indigo-100">
                 Writer: {writerName}
               </div>
             ) : (
               <button 
                 onClick={() => setIsWriterModalOpen(true)}
                 className="px-4 py-2 bg-slate-900 text-white text-xs font-bold rounded-full hover:bg-slate-800"
               >
                 Log In
               </button>
             )}
             <button className="p-2 relative text-slate-500 hover:text-indigo-600 transition-colors">
               <Bell size={20} />
               <span className="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full"></span>
             </button>
          </div>
        </header>

        {/* Dynamic Content */}
        <div className="p-4 lg:p-8 max-w-7xl mx-auto">
          
          {/* DASHBOARD VIEW */}
          {activeTab === 'dashboard' && (
            <div className="space-y-8">
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <StatCard title="League Rank" value="#4" subtext="Playoff Contender" trend="up" color="bg-indigo-500" />
                <StatCard title="Points For" value="1133.5" subtext="4th in League" trend="up" color="bg-emerald-500" />
                <StatCard title="Record" value="7-4" subtext="Win Streak: 1" trend="up" color="bg-blue-500" />
                <StatCard title="Waiver Budget" value="$96" subtext="Remaining FAAB" trend="down" color="bg-orange-500" />
              </div>

              <div className="grid lg:grid-cols-3 gap-8">
                <div className="lg:col-span-2 bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden">
                  <div className="p-6 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center">
                    <h3 className="font-bold text-lg">Standings</h3>
                    <span className="text-xs text-slate-400">Click team to view roster</span>
                  </div>
                  <div className="overflow-x-auto">
                    <table className="w-full text-left text-sm">
                      <thead className="bg-slate-50 dark:bg-slate-900/50 text-slate-500 font-medium">
                        <tr>
                          <th className="px-6 py-4">Rank</th>
                          <th className="px-6 py-4">Team</th>
                          <th className="px-6 py-4 text-center">Record</th>
                          <th className="px-6 py-4 text-right">PF</th>
                        </tr>
                      </thead>
                      <tbody className="divide-y divide-slate-100 dark:divide-slate-700">
                        {MOCK_TEAMS.map((team) => (
                          <tr 
                            key={team.id} 
                            onClick={() => team.roster ? setSelectedTeam(team) : null}
                            className={`hover:bg-slate-50 dark:hover:bg-slate-700/30 transition-colors cursor-pointer ${team.id === 4 ? 'bg-indigo-50 dark:bg-indigo-900/20' : ''}`}
                          >
                            <td className="px-6 py-4">
                              <span className={`w-6 h-6 inline-flex items-center justify-center rounded-full text-xs font-bold 
                                ${team.rank === 1 ? 'bg-yellow-100 text-yellow-700' : 
                                  team.rank === 2 ? 'bg-gray-100 text-gray-700' : 
                                  team.rank === 3 ? 'bg-orange-100 text-orange-800' : 'text-slate-500'}`}>
                                {team.rank}
                              </span>
                            </td>
                            <td className="px-6 py-4">
                              <div className="flex items-center space-x-3">
                                <div className={`w-8 h-8 rounded-full ${team.avatar}`}></div>
                                <div>
                                  <p className="font-bold text-slate-800 dark:text-white flex items-center gap-2">
                                    {team.name}
                                    {team.roster && <Eye size={14} className="text-indigo-400" />}
                                  </p>
                                  <p className="text-xs text-slate-400">{team.owner}</p>
                                </div>
                              </div>
                            </td>
                            <td className="px-6 py-4 text-center font-medium">{team.wins}-{team.losses}</td>
                            <td className="px-6 py-4 text-right text-slate-600 dark:text-slate-300">{team.pts}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </div>

                <div className="bg-indigo-900 text-white rounded-xl shadow-lg p-6 relative overflow-hidden">
                  <div className="absolute top-0 right-0 w-32 h-32 bg-indigo-500 rounded-full blur-3xl opacity-20 -mr-10 -mt-10"></div>
                  <h3 className="font-bold text-lg mb-6 relative z-10">This Week's Matchup</h3>
                  
                  <div className="flex items-center justify-between mb-8 relative z-10">
                    <div className="text-center">
                      <div className="w-16 h-16 bg-white/10 rounded-full mx-auto mb-3 flex items-center justify-center text-2xl font-bold border-2 border-white/20">
                        AS
                      </div>
                      <p className="font-bold text-sm">Hurts So Good</p>
                      <p className="text-indigo-200 text-xs">7-4</p>
                    </div>
                    <div className="text-center px-4">
                      <span className="text-2xl font-bold font-mono">VS</span>
                      <p className="text-xs text-indigo-300 mt-1">Final</p>
                    </div>
                    <div className="text-center">
                      <div className="w-16 h-16 bg-teal-500 rounded-full mx-auto mb-3 flex items-center justify-center text-2xl font-bold border-2 border-white/20 shadow-lg shadow-teal-900/50">
                        IR
                      </div>
                      <p className="font-bold text-sm">Injured Reserve</p>
                      <p className="text-indigo-200 text-xs">2-9</p>
                    </div>
                  </div>

                  <div className="space-y-3 relative z-10">
                    <div className="flex justify-between text-sm">
                      <span className="text-indigo-200">Score</span>
                      <span className="font-bold">88.90 - 76.34</span>
                    </div>
                    <div className="w-full bg-indigo-800 rounded-full h-2">
                      <div className="bg-emerald-400 h-2 rounded-full w-[55%]"></div>
                    </div>
                    <p className="text-xs text-center text-indigo-300 pt-2">
                      You won by 12.56 points.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* NEWSLETTER VIEW */}
          {activeTab === 'newsletter' && (
            <div className="max-w-3xl mx-auto">
               <div className="flex justify-between items-center mb-8">
                 <div>
                   <h3 className="text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2">
                     <Newspaper className="text-indigo-600" /> 
                     League Insider
                   </h3>
                   <p className="text-slate-500 text-sm mt-1">Latest news, rumors, and hot takes from league members.</p>
                 </div>
                 <button 
                   onClick={() => writerName ? setIsWriting(!isWriting) : setIsWriterModalOpen(true)}
                   className="flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-colors"
                 >
                   {isWriting ? <X size={18}/> : <PenTool size={18}/>}
                   {isWriting ? 'Cancel' : 'Write Article'}
                 </button>
               </div>

               {/* Write Article Form */}
               {isWriting && (
                 <div className="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-lg border border-indigo-100 dark:border-indigo-900 mb-8 animate-in fade-in slide-in-from-top-4">
                   <h4 className="font-bold text-lg mb-4 text-slate-800 dark:text-white">New Article</h4>
                   <div className="space-y-4">
                     <div>
                       <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Title</label>
                       <input 
                         type="text"
                         value={newArticle.title}
                         onChange={(e) => setNewArticle({...newArticle, title: e.target.value})}
                         placeholder="e.g. Why I'm Trading Justin Jefferson"
                         className="w-full p-3 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
                       />
                     </div>
                     
                     <div className="grid grid-cols-2 gap-4">
                        <div>
                           <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Tag</label>
                           <select 
                             value={newArticle.tag}
                             onChange={(e) => setNewArticle({...newArticle, tag: e.target.value})}
                             className="w-full p-3 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
                           >
                             <option>News</option>
                             <option>Rumor</option>
                             <option>Analysis</option>
                             <option>Trash Talk</option>
                             <option>Trade Block</option>
                           </select>
                        </div>
                        <div>
                           <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Author</label>
                           <input 
                             type="text"
                             value={writerName}
                             disabled
                             className="w-full p-3 bg-slate-100 dark:bg-slate-800 text-slate-500 border border-slate-200 dark:border-slate-700 rounded-lg cursor-not-allowed"
                           />
                        </div>
                     </div>

                     <div>
                       <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Content</label>
                       <textarea 
                         rows="6"
                         value={newArticle.content}
                         onChange={(e) => setNewArticle({...newArticle, content: e.target.value})}
                         placeholder="Spill the tea..."
                         className="w-full p-3 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none resize-none"
                       ></textarea>
                     </div>
                     
                     <div className="flex justify-end pt-2">
                       <button 
                         onClick={handlePostArticle}
                         disabled={!newArticle.title || !newArticle.content || isPosting}
                         className="bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                       >
                         {isPosting ? <Activity className="animate-spin" size={18}/> : <ArrowRight size={18}/>}
                         {isPosting ? 'Publishing...' : 'Publish Article'}
                       </button>
                     </div>
                   </div>
                 </div>
               )}

               {/* Articles List */}
               {articles.length === 0 ? (
                 <div className="text-center py-12 bg-white dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-700 border-dashed">
                    <Newspaper className="w-12 h-12 text-slate-300 mx-auto mb-3" />
                    <h4 className="text-lg font-bold text-slate-600 dark:text-slate-400">No News Yet</h4>
                    <p className="text-slate-400 text-sm mb-4">Be the first to break a story!</p>
                    <button 
                       onClick={() => writerName ? setIsWriting(true) : setIsWriterModalOpen(true)}
                       className="text-indigo-600 font-medium hover:underline"
                    >
                      Write something
                    </button>
                 </div>
               ) : (
                 <div className="space-y-6">
                   {articles.map(article => (
                     <NewsCard key={article.id} article={article} />
                   ))}
                 </div>
               )}
            </div>
          )}

          {/* MY TEAM VIEW */}
          {activeTab === 'myteam' && (
            <div className="space-y-6">
              <div className="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden">
                <div className="p-4 bg-slate-50 dark:bg-slate-900/50 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center">
                  <h3 className="font-bold text-lg text-emerald-700 dark:text-emerald-400 flex items-center gap-2">
                    <div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                    Starters
                  </h3>
                  <div className="text-sm text-slate-500">
                    Score: <span className="font-bold text-slate-900 dark:text-white">88.90</span>
                  </div>
                </div>
                <div className="divide-y divide-slate-100 dark:divide-slate-700">
                  {activePlayers.map(player => (
                    <PlayerRow key={player.id} player={player} onAction={togglePlayerStatus} isRoster={true} />
                  ))}
                </div>
              </div>

              <div className="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden">
                <div className="p-4 bg-slate-50 dark:bg-slate-900/50 border-b border-slate-100 dark:border-slate-800">
                   <h3 className="font-bold text-lg text-slate-600 dark:text-slate-400">Bench</h3>
                </div>
                <div className="divide-y divide-slate-100 dark:divide-slate-700">
                  {benchPlayers.map(player => (
                    <PlayerRow key={player.id} player={player} onAction={togglePlayerStatus} isRoster={true} />
                  ))}
                </div>
              </div>
            </div>
          )}

          {/* MATCHUPS VIEW */}
          {activeTab === 'matchups' && (
            <div className="space-y-4 max-w-3xl mx-auto">
              <div className="text-center mb-6">
                <h3 className="text-xl font-bold">League Scoreboard</h3>
                <p className="text-slate-500">Week {CURRENT_WEEK} Results</p>
              </div>
              {WEEKLY_MATCHUPS.map(matchup => (
                <MatchupRow key={matchup.id} matchup={matchup} />
              ))}
            </div>
          )}

          {/* PLAYERS VIEW */}
          {activeTab === 'players' && (
            <div className="space-y-6">
              <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
                 <h3 className="text-xl font-bold">Waiver Wire</h3>
                 <div className="flex gap-2">
                    <button className="px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm font-medium hover:bg-slate-50">All</button>
                    <button className="px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm font-medium hover:bg-slate-50">QB</button>
                    <button className="px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium shadow-sm">RB</button>
                    <button className="px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm font-medium hover:bg-slate-50">WR</button>
                 </div>
              </div>

              <div className="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden">
                <div className="divide-y divide-slate-100 dark:divide-slate-700">
                   {WAIVER_WIRE.map(player => (
                     <div key={player.id} className="flex items-center justify-between p-4 hover:bg-slate-50 dark:hover:bg-slate-700/30 transition-colors">
                       <div className="flex items-center space-x-4">
                         <div className="bg-slate-100 dark:bg-slate-700 p-2 rounded text-xs font-bold w-12 text-center">
                           {player.position}
                         </div>
                         <div>
                           <p className="font-bold text-slate-900 dark:text-white">{player.name}</p>
                           <p className="text-xs text-slate-500">{player.team} ‚Ä¢ {player.pctOwned}% Owned</p>
                         </div>
                       </div>
                       <div className="flex items-center gap-6">
                         <div className="text-right">
                           <p className="text-xs text-slate-400">Proj</p>
                           <p className="font-bold text-slate-700 dark:text-slate-300">{player.proj}</p>
                         </div>
                         <button className="p-2 bg-emerald-50 text-emerald-600 rounded-full hover:bg-emerald-100 transition-colors">
                            <UserPlus size={20} />
                         </button>
                       </div>
                     </div>
                   ))}
                </div>
              </div>
            </div>
          )}
          
          {/* CHAT VIEW */}
          {activeTab === 'chat' && (
             <div className="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 h-[600px] flex flex-col">
               <div className="p-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
                 <h3 className="font-bold">League Chat</h3>
                 <span className="text-xs text-green-500 flex items-center gap-1">‚óè 3 Online</span>
               </div>
               
               <div className="flex-1 p-4 overflow-y-auto space-y-4">
                 {MESSAGES.map(msg => (
                   <div key={msg.id} className="flex gap-3">
                     <div className={`w-8 h-8 rounded-full flex-shrink-0 ${msg.avatar}`}></div>
                     <div>
                       <div className="flex items-center gap-2">
                         <span className="font-bold text-sm text-slate-900 dark:text-white">{msg.user}</span>
                         <span className="text-xs text-slate-400">{msg.time}</span>
                       </div>
                       <p className="text-slate-600 dark:text-slate-300 text-sm mt-1 bg-slate-50 dark:bg-slate-700 p-3 rounded-tr-xl rounded-br-xl rounded-bl-xl">
                         {msg.text}
                       </p>
                     </div>
                   </div>
                 ))}
                 
                 <div className="flex gap-3 flex-row-reverse">
                     <div className="w-8 h-8 rounded-full flex-shrink-0 bg-emerald-500"></div>
                     <div className="text-right">
                       <div className="flex items-center gap-2 justify-end">
                         <span className="text-xs text-slate-400">10:55 AM</span>
                         <span className="font-bold text-sm text-slate-900 dark:text-white">AlexSeguin</span>
                       </div>
                       <p className="text-white text-sm mt-1 bg-emerald-600 p-3 rounded-tl-xl rounded-bl-xl rounded-br-xl text-left">
                         Anyone selling a QB2?
                       </p>
                     </div>
                 </div>
               </div>

               <div className="p-4 border-t border-slate-100 dark:border-slate-700">
                 <div className="flex gap-2">
                   <input 
                     type="text" 
                     placeholder="Talk smack..." 
                     className="flex-1 bg-slate-100 dark:bg-slate-900 border-0 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                   />
                   <button className="bg-indigo-600 text-white p-2 rounded-lg hover:bg-indigo-700 transition-colors">
                     <ArrowRight size={20} />
                   </button>
                 </div>
               </div>
             </div>
          )}

        </div>
      </main>

      {/* WRITER NAME MODAL */}
      {isWriterModalOpen && (
        <div className="fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4">
          <div className="bg-white dark:bg-slate-900 p-6 rounded-xl w-full max-w-sm shadow-2xl">
            <div className="text-center mb-6">
              <div className="w-12 h-12 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-3">
                <User size={24} />
              </div>
              <h3 className="text-xl font-bold text-slate-900 dark:text-white">League Login</h3>
              <p className="text-slate-500 text-sm">Enter your name to post articles.</p>
            </div>
            
            <form onSubmit={handleSetWriterName}>
              <input 
                type="text" 
                placeholder="Your Writer Handle (e.g. Commish)"
                value={writerName}
                onChange={(e) => setWriterName(e.target.value)}
                className="w-full p-3 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg mb-4 focus:ring-2 focus:ring-indigo-500 outline-none font-medium text-center"
                autoFocus
              />
              <button 
                type="submit" 
                className="w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 transition-colors"
              >
                Start Writing
              </button>
              <button 
                type="button"
                onClick={() => setIsWriterModalOpen(false)}
                className="w-full mt-2 py-2 text-sm text-slate-500 hover:text-slate-800 dark:hover:text-slate-300"
              >
                Cancel
              </button>
            </form>
          </div>
        </div>
      )}

      {/* TEAM ROSTER MODAL */}
      {selectedTeam && (
        <div className="fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4">
          <div className="bg-white dark:bg-slate-900 p-6 rounded-xl w-full max-w-2xl shadow-2xl overflow-hidden max-h-[90vh] flex flex-col">
            <div className="flex justify-between items-center mb-6">
               <div className="flex items-center gap-3">
                  <div className={`w-10 h-10 rounded-full ${selectedTeam.avatar}`}></div>
                  <div>
                    <h3 className="text-xl font-bold text-slate-900 dark:text-white">{selectedTeam.name}</h3>
                    <p className="text-sm text-slate-500">{selectedTeam.owner}</p>
                  </div>
               </div>
               <button onClick={() => setSelectedTeam(null)} className="text-slate-400 hover:text-slate-600">
                 <X size={24} />
               </button>
            </div>
            
            <div className="overflow-y-auto flex-1 pr-2">
               <div className="bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-100 dark:border-slate-800">
                 {selectedTeam.roster && selectedTeam.roster.map(player => (
                   <PlayerRow key={player.id} player={player} isRoster={false} />
                 ))}
                 {!selectedTeam.roster && (
                   <div className="p-8 text-center text-slate-500">
                     Roster data not available for this team.
                   </div>
                 )}
               </div>
            </div>
          </div>
        </div>
      )}

    </div>
  );
}
